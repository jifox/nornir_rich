

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>nornir_rich &mdash; nornir_rich  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Tutorials" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> nornir_rich
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">nornir_rich</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">nornir_rich</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>nornir_rich</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/nornir_rich.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="nornir_rich">
<h1>nornir_rich<a class="headerlink" href="#nornir_rich" title="Permalink to this headline">¶</a></h1>
<p>nornir_rich plugin is a combination of a processor to get additional detail for results and related functions. By default all results are output to stdout without requiring and print_result statements.</p>
<p>The processor constructor has some options related to keeping track of timing, screen width and whether or not to utilize progress bars. The example below uses all defaults.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">nornir</span> <span class="kn">import</span> <span class="n">InitNornir</span>
<span class="kn">from</span> <span class="nn">nornir_napalm.plugins.tasks</span> <span class="kn">import</span> <span class="n">napalm_get</span>

<span class="n">nr</span> <span class="o">=</span> <span class="n">InitNornir</span><span class="p">(</span>
    <span class="n">inventory</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;plugin&quot;</span><span class="p">:</span> <span class="s2">&quot;SimpleInventory&quot;</span><span class="p">,</span>
        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;host_file&quot;</span><span class="p">:</span> <span class="s2">&quot;inventory/hosts.yaml&quot;</span><span class="p">,</span>
            <span class="s2">&quot;group_file&quot;</span><span class="p">:</span> <span class="s2">&quot;inventory/groups.yaml&quot;</span><span class="p">,</span>
            <span class="s2">&quot;defaults_file&quot;</span><span class="p">:</span> <span class="s2">&quot;inventory/defaults.yaml&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>After creating the standard Nornir object, a RichResults processor object is instantiated and added to Nornir. The width of 67 in the example was only used as this notebook is going into read the docs via sphinx and without it the output required a scroll bar. Normally leaving this at defaults will just use up max length of the terminal.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">nornir_rich.plugins.functions</span> <span class="kn">import</span> <span class="n">RichResults</span>
<span class="n">rr</span> <span class="o">=</span> <span class="n">RichResults</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>A basic password transform is done on the inventory using dotenv applied environment variables. This is just for test environment setup.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span><span class="p">,</span> <span class="n">find_dotenv</span>
<span class="n">load_dotenv</span><span class="p">(</span><span class="n">find_dotenv</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">passwd_from_env</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
    <span class="n">task</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>

<span class="n">rr</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">nr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">passwd_from_env</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">passwd_from_env*****************************************************************
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #000080">* vyos ** changed = </span><span style="color: #ff0000; font-style: italic">False</span><span style="color: #000080"> ******************************************************</span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #005f00">vvvv passwd_from_env ** changed = False vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv INFO</span>
</pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #005f00">^^^^ END passwd_from_env ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
</pre></div>
</div>
<p>By default, write_inventory function won’t list passwords without the passwords=True argument.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rr</span><span class="o">.</span><span class="n">inventory</span><span class="p">(</span><span class="n">nr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">╭────────────────┬─────────────────────────────────────────────────────────────╮
│<span style="font-weight: bold"> Host           </span>│<span style="font-weight: bold"> Data                                                        </span>│
├────────────────┼─────────────────────────────────────────────────────────────┤
│ vyos           │ connection_options: {}                                      │
│                │ data: {}                                                    │
│                │ groups: []                                                  │
│                │ hostname: localhost                                         │
│                │ name: vyos                                                  │
│                │ password: '******'                                          │
│                │ platform: vyos                                              │
│                │ port: null                                                  │
│                │ username: vyos                                              │
│                │                                                             │
╰────────────────┴─────────────────────────────────────────────────────────────╯
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rr</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">nr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">napalm_get</span><span class="p">,</span> <span class="n">getters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;interfaces&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;run1&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">run1****************************************************************************
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #000080">* vyos ** changed = </span><span style="color: #ff0000; font-style: italic">False</span><span style="color: #000080"> ******************************************************</span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800000">vvvv run1 ** changed = False vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv ERROR</span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Traceback (most recent call last):
  File "/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/nornir/core/task.py",
line 98, in start
    r = self.task(self, **self.params)
  File "/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/nornir_napalm/plugins
/tasks/napalm_get.py", line 32, in napalm_get
    device = task.host.get_connection(CONNECTION_NAME, task.nornir.config)
  File
"/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/nornir/core/inventory.py",
line 440, in get_connection
    self.open_connection(
  File
"/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/nornir/core/inventory.py",
line 492, in open_connection
    conn_obj.open(
  File "/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/nornir_napalm/plugins
/connections/__init__.py", line 57, in open
    connection.open()
  File "/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/napalm_vyos/vyos.py",
line 98, in open
    self.device = ConnectHandler(device_type='vyos',
  File
"/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/netmiko/ssh_dispatcher.py",
line 302, in ConnectHandler
    return ConnectionClass(*args, **kwargs)
  File
"/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/netmiko/base_connection.py",
line 344, in __init__
    self._open()
  File
"/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/netmiko/base_connection.py",
line 349, in _open
    self.establish_connection()
  File
"/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/netmiko/base_connection.py",
line 918, in establish_connection
    self.remote_conn_pre.connect(**ssh_connect_params)
  File "/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/paramiko/client.py",
line 435, in connect
    self._auth(
  File "/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/paramiko/client.py",
line 764, in _auth
    raise saved_exception
  File "/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/paramiko/client.py",
line 751, in _auth
    self._transport.auth_password(username, password)
  File
"/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/paramiko/transport.py", line
1509, in auth_password
    return self.auth_handler.wait_for_response(my_event)
  File
"/home/patrick/dev/nornir_rich/.venv/lib/python3.8/site-packages/paramiko/auth_handler.py",
line 250, in wait_for_response
    raise e
paramiko.ssh_exception.AuthenticationException: Authentication failed.

</pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800000">^^^^ END run1 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
</pre></div>
</div>
<p>The write_summary method will provide a summary of the run.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rr</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">╭───────────────────────────────────────────────┬──────────┬─────────┬─────────╮
│<span style="font-weight: bold"> Task                                          </span>│<span style="font-weight: bold"> Ok       </span>│<span style="font-weight: bold"> Changed </span>│<span style="font-weight: bold"> Failed  </span>│
├───────────────────────────────────────────────┼──────────┼─────────┼─────────┤
│ passwd_from_env                               │ 1        │ -       │ -       │
│ return_changed                                │ -        │ -       │ -       │
│ return_failed                                 │ -        │ -       │ -       │
│ return_changed                                │ -        │ -       │ -       │
│ grouped                                       │ 3        │ 1       │ -       │
│ run1                                          │ -        │ -       │ 1       │
├───────────────────────────────────────────────┼──────────┼─────────┼─────────┤
│<span style="font-weight: bold"> Total                                         </span>│<span style="font-weight: bold"> 4        </span>│<span style="font-weight: bold"> 1       </span>│<span style="font-weight: bold"> 1       </span>│
╰───────────────────────────────────────────────┴──────────┴─────────┴─────────╯
</pre></div>
</div>
<p>Skip messages are displayed by default for skipped hosts when a task is run from nr with skipped hosts present.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nr</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">reset_failed_hosts</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">nornir.core.task</span> <span class="kn">import</span> <span class="n">Result</span>

<span class="k">def</span> <span class="nf">return_changed</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">return_failed</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">failed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">rr</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">nr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">return_changed</span><span class="p">))</span>
<span class="n">rr</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">nr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">return_failed</span><span class="p">))</span>
<span class="n">rr</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">nr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">return_changed</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">return_changed******************************************************************
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #000080">* vyos ** changed = </span><span style="color: #00ff00; font-style: italic">True</span><span style="color: #000080"> *******************************************************</span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #ffaf00">vvvv return_changed ** changed = True vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv INFO</span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #ffaf00">^^^^ END return_changed ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">return_failed*******************************************************************
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #000080">* vyos ** changed = </span><span style="color: #ff0000; font-style: italic">False</span><span style="color: #000080"> ******************************************************</span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800000">vvvv return_failed ** changed = False vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv ERROR</span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800000">^^^^ END return_failed ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
</pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">return_changed******************************************************************
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rr</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">╭───────────────────────────────────────────────┬──────────┬─────────┬─────────╮
│<span style="font-weight: bold"> Task                                          </span>│<span style="font-weight: bold"> Ok       </span>│<span style="font-weight: bold"> Changed </span>│<span style="font-weight: bold"> Failed  </span>│
├───────────────────────────────────────────────┼──────────┼─────────┼─────────┤
│ passwd_from_env                               │ 1        │ -       │ -       │
│ return_changed                                │ -        │ -       │ -       │
│ return_failed                                 │ -        │ -       │ -       │
│ return_changed                                │ -        │ -       │ -       │
│ grouped                                       │ 3        │ 1       │ -       │
│ run1                                          │ -        │ -       │ 1       │
│ return_changed                                │ -        │ 1       │ -       │
│ return_failed                                 │ -        │ -       │ 1       │
│ return_changed                                │ -        │ -       │ -       │
├───────────────────────────────────────────────┼──────────┼─────────┼─────────┤
│<span style="font-weight: bold"> Total                                         </span>│<span style="font-weight: bold"> 4        </span>│<span style="font-weight: bold"> 2       </span>│<span style="font-weight: bold"> 2       </span>│
╰───────────────────────────────────────────────┴──────────┴─────────┴─────────╯
</pre></div>
</div>
<p>Output formats are mostly handled ok and can either be highlighted with rich or left as uncolored. By default it is uncolored as the highlighting isn’t exactly pleasing to my eyes minus the exceptions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">return_diff</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;inventory/test.diff&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">diff</span><span class="o">=</span><span class="n">diff</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">return_json</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
    <span class="n">json</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;inventory/test.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">json</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">return_xml</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
    <span class="n">xml</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;inventory/test.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">xml</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">grouped</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
    <span class="n">task</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">return_diff</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">return_json</span><span class="p">)</span>
    <span class="n">task</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">return_xml</span><span class="p">)</span>

<span class="n">nr</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">reset_failed_hosts</span><span class="p">()</span>
<span class="n">rr</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">nr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">grouped</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">grouped*************************************************************************
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #000080">* vyos ** changed = </span><span style="color: #00ff00; font-style: italic">True</span><span style="color: #000080"> *******************************************************</span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #005f00">vvvv grouped ** changed = False vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv INFO</span>
</pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-14-dac04d34c47d&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     17</span>
<span class="ansi-green-intense-fg ansi-bold">     18</span> nr<span class="ansi-blue-fg">.</span>data<span class="ansi-blue-fg">.</span>reset_failed_hosts<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 19</span><span class="ansi-red-fg"> </span>rr<span class="ansi-blue-fg">.</span>print<span class="ansi-blue-fg">(</span>nr<span class="ansi-blue-fg">.</span>run<span class="ansi-blue-fg">(</span>grouped<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/nornir_rich/nornir_rich/plugins/functions/rich_result.py</span> in <span class="ansi-cyan-fg">print</span><span class="ansi-blue-fg">(self, result, vars, failed, severity_level)</span>
<span class="ansi-green-intense-fg ansi-bold">     41</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     42</span>             self<span class="ansi-blue-fg">.</span>results<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>result<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 43</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>_print_result<span class="ansi-blue-fg">(</span>result<span class="ansi-blue-fg">,</span> vars<span class="ansi-blue-fg">,</span> failed<span class="ansi-blue-fg">,</span> severity_level<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     44</span>         <span class="ansi-green-fg">finally</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     45</span>             LOCK<span class="ansi-blue-fg">.</span>release<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/dev/nornir_rich/nornir_rich/plugins/functions/rich_result.py</span> in <span class="ansi-cyan-fg">_print_result</span><span class="ansi-blue-fg">(self, result, vars, failed, severity_level)</span>
<span class="ansi-green-intense-fg ansi-bold">     64</span>                     style<span class="ansi-blue-fg">=</span>Style<span class="ansi-blue-fg">(</span>color<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;blue&#34;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     65</span>                 )
<span class="ansi-green-fg">---&gt; 66</span><span class="ansi-red-fg">                 </span>self<span class="ansi-blue-fg">.</span>_print_result<span class="ansi-blue-fg">(</span>host_data<span class="ansi-blue-fg">,</span> vars<span class="ansi-blue-fg">,</span> failed<span class="ansi-blue-fg">,</span> severity_level<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     67</span>
<span class="ansi-green-intense-fg ansi-bold">     68</span>         <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>result<span class="ansi-blue-fg">,</span> MultiResult<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/dev/nornir_rich/nornir_rich/plugins/functions/rich_result.py</span> in <span class="ansi-cyan-fg">_print_result</span><span class="ansi-blue-fg">(self, result, vars, failed, severity_level)</span>
<span class="ansi-green-intense-fg ansi-bold">     70</span>
<span class="ansi-green-intense-fg ansi-bold">     71</span>             <span class="ansi-green-fg">for</span> r <span class="ansi-green-fg">in</span> result<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 72</span><span class="ansi-red-fg">                 </span>self<span class="ansi-blue-fg">.</span>_print_result<span class="ansi-blue-fg">(</span>r<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     73</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span>             msg <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">f&#34;{&#39;^&#39; * 4} END {result[0].name} &#34;</span>

<span class="ansi-red-fg">TypeError</span>: _print_result() missing 3 required positional arguments: &#39;vars&#39;, &#39;failed&#39;, and &#39;severity_level&#39;
</pre></div></div>
</div>
<p>Or highlighted…</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Patrick Avery

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>